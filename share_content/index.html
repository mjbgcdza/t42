<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auto Message</title>
    <meta name="description" content="shareTargetPicker for LIFF App" />
    <meta name="author" content="T42" />
    <meta property="og:title" content="shareTargetPicker-T42-thailand" />
    <meta property="og:description" content="shareTargetPicker for LIFF App" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://wusxtldmqsleacfcibum.supabase.co/storage/v1/object/public/user-images/U48c16d105f55ec3ad6a6b52f72142abd/1758902020164.jpeg" />
    <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
     @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&family=Prompt:wght@400;500;600;700&display=swap');

    body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; font-family: 'Prompt', sans-serif; background-color: #f1f5f9; }
    #status { font-size: 1.2rem; margin-bottom: 20px; text-align:center; }
    #sendBtn { display:none; padding:10px 20px; background:#06C755; color:#fff; border-radius:10px; cursor:pointer; }
  </style>
</head>
<body>
  <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  <button id="sendBtn">üì§ ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>

  <script>
    const LIFF_ID = "2007934888-K3Ak3pqb"; 
    const OA_FRIEND_LINK = "@645hovhz";

    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get("img") || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ img";

    async function checkFriendship() {
      try {
        const data = await liff.getFriendship();
        if (!data.friendFlag) {
          await Swal.fire({
            title: "‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏Å‡πà‡∏≠‡∏ô!",
            text: "‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤",
            icon: "warning",
            confirmButtonText: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢"
          });
          window.location.href = "https://line.me/R/ti/p/" + OA_FRIEND_LINK;
          return false;
        }
        return true;
      } catch (err) {
        console.warn("‚ö†Ô∏è getFriendship ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å browser):", err);
        return true; 
      }
    }

    async function sendFlex(eventId) {
      const flexMessage = [{
  "type": "image",
  "originalContentUrl": eventId,
  "previewImageUrl": eventId
},{
        "type": "flex",
        "altText": "‡∏õ‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô",
        "contents": {
  "type": "bubble",
  "footer": {
    "type": "box",
    "layout": "vertical",
    "contents": [
      {
        "type": "text",
        "text": "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥",
        "contents": [
          {
            "type": "span",
            "text": "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÇ‡∏î‡∏¢: "
          },
          {
            "type": "span",
            "text": liff.getDecodedIDToken().name,
            "weight": "bold",
            "color": "#ce915e"
          }
        ],
           "wrap": true
      },
      {
        "type": "button",
        "action": {
          "type": "uri",
          "label": "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢",
          "uri": "https://line.me/R/ti/p/" + OA_FRIEND_LINK
        },
        "height": "sm",
        "style": "primary",
        "margin": "md"
      },
      {
        "type": "button",
        "action": {
          "type": "uri",
          "label": "‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô",
          "uri": `https://liff.line.me/${LIFF_ID}?img=${encodeURIComponent(eventId)}`
        },
        "margin": "md"
      }
    ]
  },
  "size": "hecto"
}
      }];

      try {
        const res = await liff.shareTargetPicker(flexMessage);
        if (res) {
          document.getElementById("status").innerText = "‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!";
          if (liff.isInClient()) setTimeout(() => liff.closeWindow(), 1500);
        } else {
          document.getElementById("status").innerText = "‚ùå ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
          setTimeout(() => liff.closeWindow(), 1500);
        }
      } catch (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á:", error);
        document.getElementById("status").innerText = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ: " + error.message;
      }
    }

    async function main() {
      try {
        await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });

        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
          return;
        }

        const isFriend = await checkFriendship();
        if (!isFriend) return;

        if (liff.isInClient()) {
          
          sendFlex(eventId);
          return;
        }

       
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        if (isMobile) {
          document.getElementById("status").innerText = "‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Browser ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App";
          document.getElementById("sendBtn").innerText = "üîó ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE App";
          document.getElementById("sendBtn").style.display = "block";
          document.getElementById("sendBtn").onclick = () => {
            
            window.location.href = `https://liff.line.me/${LIFF_ID}?img=${encodeURIComponent(eventId)}`;
          };
        } else {
       
          document.getElementById("status").innerText = "‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Desktop ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏î‡πâ";
          document.getElementById("sendBtn").innerText = "üì§ ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ä‡∏£‡πå";
          document.getElementById("sendBtn").style.display = "block";
          document.getElementById("sendBtn").onclick = () => sendFlex(eventId);
        }

      } catch (err) {
        console.error("LIFF init error:", err);
        document.getElementById("status").innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message;
      }
    }

    main();

     const message = "‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö";

    document.addEventListener("contextmenu", function (e) {
        Swal.fire('Oh!', message, 'error');
    
        e.preventDefault();
    });

    document.addEventListener("mousedown", function (e) {
        if (e.button === 2 || e.button === 1) {
        Swal.fire('Oh!', message, 'error');
        
        e.preventDefault();
        }
    });
  </script>
</body>
</html>
