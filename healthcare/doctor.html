<!doctypehtml><html lang=th><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>จัดการผู้ป่วย (สำหรับแพทย์)</title><script src=https://cdn.tailwindcss.com></script><meta name=description content="จัดการผู้ป่วย (สำหรับแพทย์) for LIFF App"><meta name=author content=T42><meta property=og:title content="จัดการผู้ป่วย (สำหรับแพทย์)-T42-thailand"><meta property=og:description content="ระบบจัดการผู้ป่วย (สำหรับแพทย์) for LIFF App"><meta property=og:type content=website><meta property=og:image content=https://lh3.googleusercontent.com/d/1Ms4fNBq5__DOhvBKAAb94-rUIjPjhjJ3><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap"rel=stylesheet><link rel=stylesheet href=https://bit.ly/fontiton5 charset=utf-8><script src=https://cdn.jsdelivr.net/npm/sweetalert2@11></script><script src=https://static.line-scdn.net/liff/edge/2/sdk.js></script><style>*{font-family:line_seed_sans_th}body{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);min-height:100vh}.glass-card{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);box-shadow:0 25px 50px rgba(0,0,0,.1)}.gradient-btn{background:linear-gradient(135deg,#667eea 0,#764ba2 100%);transition:all .3s ease}.gradient-btn:hover{transform:translateY(-2px);box-shadow:0 15px 30px rgba(102,126,234,.4)}.floating-label{position:relative}.floating-label input,.floating-label textarea{border:2px solid #e2e8f0;border-radius:16px;padding:20px 16px 8px 16px;background:rgba(255,255,255,.9);transition:all .3s ease;width:100%;font-size:16px}.floating-label input:focus,.floating-label textarea:focus{outline:0;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1);background:#fff}.floating-label label{position:absolute;left:16px;top:20px;color:#64748b;font-size:16px;font-weight:500;transition:all .3s ease;pointer-events:none;background:#fff;padding:0 4px}.floating-label input:focus+label,.floating-label input:not(:placeholder-shown)+label,.floating-label textarea:focus+label,.floating-label textarea:not(:placeholder-shown)+label{top:-8px;font-size:12px;color:#667eea;font-weight:600}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.animate-fadeInUp{animation:fadeInUp .6s ease-out forwards}.animate-scaleIn{animation:scaleIn .4s ease-out forwards}.medical-spinner{width:60px;height:60px;border:4px solid rgba(255,255,255,.3);border-top:4px solid #667eea;border-radius:50%;animation:spin 1s linear infinite}#loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,rgba(102,126,234,.9),rgba(118,75,162,.9));display:flex;justify-content:center;align-items:center;z-index:9999;flex-direction:column;color:#fff;transition:opacity .3s ease}.tab-btn{@apply py-3 px-4 text-gray-500 font-semibold border-b-4 border-transparent transition-all duration-300;}.tab-btn.active{@apply text-purple-600 border-purple-600;}</style><div id=loading-overlay class=hidden><div class=medical-spinner></div><div id=loading-text class="mt-6 text-center text-xl font-semibold"></div></div><div class="container mx-auto max-w-4xl p-4 md:p-6"><div id=scan-view class="min-h-screen flex items-center justify-center"><div class="w-full max-w-md animate-scaleIn"><div class="glass-card rounded-3xl p-8 text-center"><div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-lg"><img src=https://lh3.googleusercontent.com/d/1Ck_OCfEW4dEp3A1k9yfQplYmW7qmwzFF alt=Logo class="w-full h-full rounded-full object-cover bg-white"></div><h2 class="text-2xl font-bold text-gray-800 mb-2">สวัสดี,<span id=doctor-display-name>คุณหมอ</span></h2><p class="text-gray-600 mb-8">กรุณาสแกน QR Code เพื่อดูข้อมูลผู้ป่วย</p><button id=scan-qr-btn class="gradient-btn w-full text-white font-bold py-4 px-6 rounded-2xl shadow-lg text-lg">เริ่มสแกน</button></div></div></div><div id=patient-view class="hidden animate-fadeInUp"><div class="glass-card rounded-3xl p-6 md:p-8 mb-6"><div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-4"><div><h2 id=patient-name class="text-3xl font-bold text-gray-800"></h2><div class="flex items-center space-x-4 text-gray-600 mt-2"><span>ID:<span id=patient-id class=font-semibold></span></span><span>อายุ:<span id=patient-age class=font-semibold></span>ปี</span><span>เพศ:<span id=patient-gender class=font-semibold></span></span></div></div><button id=back-to-scan-btn class="mt-4 md:mt-0 w-full md:w-auto bg-gray-100 text-gray-700 font-bold py-2 px-4 rounded-xl hover:bg-gray-200 transition-colors">สแกนคนถัดไป</button></div><div class="border-t border-gray-200 pt-4 mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><div class="flex items-center"><svg class="w-5 h-5 mr-2 text-red-500"xmlns=http://www.w3.org/2000/svg viewBox="0 0 20 20"fill=currentColor><path fill-rule=evenodd d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"clip-rule=evenodd /></svg><strong>โรคประจำตัว:</strong><span id=patient-disease class=ml-2></span></div><div class="flex items-center"><img id=patient-doctor-image class="w-8 h-8 rounded-full mr-2"><svg class="w-5 h-5 mr-2 text-indigo-500"xmlns=http://www.w3.org/2000/svg viewBox="0 0 20 20"fill=currentColor><path d="M7 8a3 3 0 100-6 3 3 0 000 6zM14.5 9a3.5 3.5 0 100-7 3.5 3.5 0 000 7zM1.088 13.361A2.5 2.5 0 013.5 11h3a2.5 2.5 0 012.412 2.361A6.002 6.002 0 0010 15a6.002 6.002 0 001.088-.639A2.5 2.5 0 0113.5 11h3a2.5 2.5 0 012.412 2.361A6.002 6.002 0 0010 15a6.002 6.002 0 00-8.912-1.639z"/></svg><strong>แพทย์ผู้ดูแล:</strong><span id=patient-doctor class=ml-2></span></div></div></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="glass-card rounded-3xl p-6 md:p-8"><h3 class="text-xl font-bold text-gray-800 mb-6">บันทึกการรักษาและนัดหมาย</h3><form id=appointment-form class=space-y-6><div class=floating-label><textarea id=doctor-notes placeholder=" "rows=4></textarea><label for=doctor-notes>บันทึกการรักษา / หมายเหตุ</label></div><div class=floating-label><input type=date id=appointment-date placeholder=" "><label for=appointment-date>นัดหมายครั้งถัดไป</label></div><button type=submit class="gradient-btn w-full text-white font-bold py-4 px-6 rounded-2xl shadow-lg text-lg">บันทึกข้อมูล</button></form></div><div class="glass-card rounded-3xl p-6 md:p-8"><h3 class="text-xl font-bold text-gray-800 mb-4">ประวัติผู้ป่วย</h3><div class="border-b border-gray-200 mb-4"><nav class="flex space-x-2"><button id=tab-appointments class="tab-btn active">การนัดหมาย</button><button id=tab-medications class=tab-btn>รายการยา</button></nav></div><div id=history-content-container class="max-h-96 overflow-y-auto pr-2"><div id=appointments-content></div><div id=medications-content class=hidden></div></div></div></div></div></div><script>const _0x3bb39a=_0x5c60;function _0x2f45(){const t=["querySelectorAll",".floating-label label","Save appointment failed:","appointments","length",'\n                <div class="history-item">\n                    <p class="font-semibold text-gray-800">',".tab-btn","สำหรับทดสอบ: กรุณาใส่ Patient ID:","https://script.google.com/macros/s/AKfycbww4UnbY6_gLYdDkvIS-EQxCJgtlWx-3ya1YS4Q-ljcCCtX0RiIo6k6IMBW3jal1W74QA/exec","split","fire","</p>\n                </div>\n            ","appointments-content","ไม่สามารถดึงข้อมูลผู้ป่วยได้","https://line.me/R/ti/p/@542dytmv","click","none","patient-name","href","กำลังเปิดกล้อง...","forEach","loading-overlay","AssignedDoctor","QR Code ไม่ถูกต้อง","status","N/A","loading-text","th-TH","getOS","Scan failed:","ไม่พบรหัสผู้ป่วยใน QR Code","submit",'</p>\n                    <p class="text-sm text-gray-600 mt-1">บันทึกโดย: ',"display","error","ไม่อนุญาตให้คลิกขวาครับ","flex","preventDefault",'</p>\n                            <p class="text-sm text-gray-600">ขนาด: ',"success","button","contextmenu","getProfile","textContent","scanCode","warning","ไม่พบข้อมูล","top","3954210JxTJTX","isInClient","then",'<p class="text-gray-500 text-center p-4">ไม่มีประวัติการนัดหมาย</p>',"MedName","toISOString","hidden","patient-id","431120sjdVAz","addEventListener","Dosage","2240082WxsFIp","login",'<p class="text-gray-500 text-center p-4">ไม่มียาในรายการ</p>',"displayName","กรุณาเลือกวันนัดหมาย","addAppointment","min","Oh!","patient-doctor","block","data","patient-age","stringify","#667eea","medications-content","appointment-date","Time",'\n                <div class="history-item">\n                    <div class="flex justify-between items-center">\n                        <div>\n                            <p class="font-semibold text-gray-800">',"USER_CANCEL","innerHTML","Age","doctor-notes","DoctorNotes",'</p>\n                    <p class="text-sm text-gray-700 bg-gray-50 p-2 rounded-md mt-2">หมายเหตุ: ',"An unknown API error occurred.","กำลังดึงข้อมูลผู้ป่วย...","?action=getPatientDetails&id=","Fetch patient data failed:","DoctorName","คุณหมอ","medications","classList","เดี๋ยวก่อน!","appointment-form","patientId","9875220cuaLMD","patientFound","join","7zegQLG","8VCZyQR","location","ไม่พบข้อมูลผู้ป่วยสำหรับ ID: ","331084aibQoE","message","กำลังประมวลผล...","ข้อมูลไม่ครบถ้วน","สแกนล้มเหลว","scan-qr-btn","11DAMCyY","https://placehold.co/100x100/E2E8F0/4A5568?text=N/A","map","1887bMGxpA","remove","value","code","Gender","กำลังบันทึกข้อมูล...","active","add","reset","mousedown","text/plain;charset=utf-8","1128rgUFZT","DOMContentLoaded","src","เกิดข้อผิดพลาด","json","get","getElementById","บันทึกสำเร็จ","style","235301DqUhlP","full","searchParams","toLocaleDateString","LIFF Init failed:",'</p>\n                        </div>\n                        <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">เวลา: ',"patient-gender"];return(_0x2f45=function(){return t})()}!function(t,e){const n=_0x5c60,a=_0x2f45();for(;;)try{if(341473===parseInt(n(308))/1+-parseInt(n(299))/2*(-parseInt(n(288))/3)+-parseInt(n(279))/4+-parseInt(n(234))/5+parseInt(n(226))/6*(parseInt(n(275))/7)+parseInt(n(276))/8*(parseInt(n(237))/9)+parseInt(n(272))/10*(-parseInt(n(285))/11))break;a.push(a.shift())}catch(t){a.push(a.shift())}}();const API_URL=_0x3bb39a(186),LIFF_ID="2007778477-Jn482o2V",loadingOverlay=document.getElementById(_0x3bb39a(199)),loadingText=document[_0x3bb39a(305)](_0x3bb39a(204)),scanView=document[_0x3bb39a(305)]("scan-view"),patientView=document.getElementById("patient-view"),scanBtn=document[_0x3bb39a(305)](_0x3bb39a(284)),backToScanBtn=document[_0x3bb39a(305)]("back-to-scan-btn"),doctorDisplayName=document[_0x3bb39a(305)]("doctor-display-name"),appointmentForm=document[_0x3bb39a(305)](_0x3bb39a(270));let currentPatientId=null,doctorProfile={displayName:_0x3bb39a(266),userId:null};function toggleLoading(t,e=_0x3bb39a(281)){const n=_0x3bb39a;loadingText[n(221)]=e,loadingOverlay[n(307)][n(211)]=t?"flex":n(194)}async function initializeLiff(){const t=_0x3bb39a;toggleLoading(!0,"กำลังเชื่อมต่อ...");try{if(await liff.init({liffId:LIFF_ID,withLoginOnExternalBrowser:!0}),!liff.isLoggedIn())return void liff[t(238)]({redirectUri:window[t(277)][t(196)]});doctorProfile=await liff[t(220)](),doctorDisplayName[t(221)]=doctorProfile.displayName;if(!(await liff.getFriendship()).friendFlag)return void Swal[t(188)]({icon:t(212),title:t(269),text:"คุณยังไม่ได้เป็นเพื่อนกับเรา",confirmButtonText:"เพิ่มเพื่อน"})[t(228)]((()=>{const e=t;window[e(277)]=e(192)}))}catch(e){console[t(212)](t(312),e),Swal[t(188)]({title:"ข้อผิดพลาด",text:"ไม่สามารถเริ่มต้น LIFF ได้",icon:t(212),confirmButtonColor:t(250)})}finally{toggleLoading(!1)}}async function handleScan(){const t=_0x3bb39a;if(liff[t(227)]()){toggleLoading(!0,t(197));try{const e="android"===liff[t(206)]()?await liff[t(222)]():await liff.scanCodeV2();if(toggleLoading(!1),e&&e[t(290)]){const n=new URL(e[t(290)])[t(310)][t(304)](t(271));n?await fetchAndDisplayPatient(n):Swal[t(188)](t(201),t(208),t(212))}}catch(e){console[t(212)](t(207),e),(!e.code||e[t(291)]!==t(255))&&Swal[t(188)](t(283),e[t(280)]||"เกิดข้อผิดพลาด","error")}finally{toggleLoading(!1)}}else{const e=prompt(t(185));e&&await fetchAndDisplayPatient(e)}}async function fetchAndDisplayPatient(t){const e=_0x3bb39a;toggleLoading(!0,e(262));try{const n=await fetch(API_URL+e(263)+t),a=await n[e(303)]();if("success"===a.status&&a[e(247)][e(273)]){currentPatientId=t;const n=a.data;document[e(305)](e(195)).textContent=n.Name,document[e(305)](e(233)).textContent=n.PatientID,document.getElementById(e(248)).textContent=n[e(257)],document[e(305)](e(314))[e(221)]=n[e(292)],document.getElementById("patient-disease")[e(221)]=n.UnderlyingDisease,document.getElementById(e(245))[e(221)]=n[e(200)],document[e(305)]("patient-doctor-image")[e(301)]=n.DoctorImage||e(286),renderHistory(n[e(318)],n[e(267)]),scanView[e(307)].display="none",patientView.style[e(211)]=e(246)}else Swal[e(188)](e(224),e(278)+t,e(212))}catch(t){console[e(212)](e(264),t),Swal[e(188)](e(302),e(191),"error")}finally{toggleLoading(!1)}}function renderHistory(t,e){const n=_0x3bb39a,a=document[n(305)](n(190)),o=document[n(305)](n(251));a[n(256)]=t[n(319)]>0?t[n(287)]((t=>n(320)+new Date(t.AppointmentDate)[n(311)](n(205),{dateStyle:n(309)})+n(210)+(t[n(265)]||n(203))+n(260)+(t[n(259)]||"-")+n(189))).join(""):n(229),o[n(256)]=e[n(319)]>0?e[n(287)]((t=>n(254)+t[n(230)]+n(216)+t[n(236)]+n(313)+t[n(253)]+"</div>\n                    </div>\n                </div>\n            "))[n(274)](""):n(239)}async function handleSaveAppointment(t){const e=_0x3bb39a;t.preventDefault();const n=document[e(305)](e(258))[e(290)],a=document[e(305)](e(252))[e(290)];if(!a)return void Swal[e(188)](e(282),e(241),e(223));toggleLoading(!0,e(293));const o={action:e(242),payload:{patientId:currentPatientId,appointmentDate:a,doctorNotes:n,doctorName:doctorProfile[e(240)]}};try{const t=await fetch(API_URL,{method:"POST",headers:{"Content-Type":e(298)},body:JSON[e(249)](o)}),n=await t[e(303)]();if(n[e(202)]!==e(217))throw new Error(n[e(280)]||e(261));toggleLoading(!1),await Swal[e(188)]({icon:e(217),title:e(306),showConfirmButton:!1,timer:1500}),appointmentForm.reset(),document[e(315)](e(316))[e(198)]((t=>t.style[e(225)]="20px")),await fetchAndDisplayPatient(currentPatientId)}catch(t){console[e(212)](e(317),t),Swal[e(188)](e(302),"ไม่สามารถบันทึกข้อมูลได้: "+t[e(280)],e(212))}finally{toggleLoading(!1)}}function setupTabs(){const t=_0x3bb39a,e=document[t(315)](t(321)),n={"tab-appointments":document[t(305)](t(190)),"tab-medications":document[t(305)](t(251))};e[t(198)]((a=>{const o=t;a[o(235)](o(193),(()=>{const t=o;e[t(198)]((e=>e[t(268)][t(289)](t(294)))),a.classList[t(295)](t(294)),Object.values(n)[t(198)]((e=>e[t(268)][t(295)](t(232)))),n[a.id][t(268)].remove("hidden")}))}))}function _0x5c60(t,e){const n=_0x2f45();return(_0x5c60=function(t,e){return n[t-=185]})(t,e)}scanBtn[_0x3bb39a(235)](_0x3bb39a(193),handleScan),backToScanBtn.addEventListener(_0x3bb39a(193),(()=>{const t=_0x3bb39a;patientView[t(307)][t(211)]=t(194),scanView[t(307)].display=t(214),currentPatientId=null,appointmentForm[t(296)]()})),appointmentForm[_0x3bb39a(235)](_0x3bb39a(209),handleSaveAppointment),document[_0x3bb39a(235)](_0x3bb39a(300),(()=>{const t=_0x3bb39a;initializeLiff(),setupTabs(),document[t(305)]("appointment-date")[t(243)]=(new Date)[t(231)]()[t(187)]("T")[0]}));const message=_0x3bb39a(213);document[_0x3bb39a(235)](_0x3bb39a(219),(function(t){const e=_0x3bb39a;Swal[e(188)](e(244),message,"error"),t[e(215)]()})),document[_0x3bb39a(235)](_0x3bb39a(297),(function(t){const e=_0x3bb39a;(2===t[e(218)]||1===t.button)&&(Swal.fire(e(244),message,e(212)),t[e(215)]())}))</script>
