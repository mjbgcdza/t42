<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>CRM Pro - MINI App</title>
    <link id="favicon" rel="icon" href="https://cdn-icons-png.flaticon.com/128/15267/15267807.png">
    <link id="apple-touch-icon" rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/128/15267/15267807.png">
    <meta name="description" content="CRM PRO for MINI App" />
    <meta name="author" content="T42" />
    <meta property="og:title" content="CRM PRO-T42-thailand" />
    <meta property="og:description" content="CRM for MINI App" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/128/15267/15267807.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { line: '#06C755', dark: '#1e293b' },
                    fontFamily: { prompt: ['Prompt', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        [v-cloak] { display: none !important; }
        body { background-color: #f8fafc; font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        
        .card-member { background: linear-gradient(135deg, #475569 0%, #1e293b 100%); color: white; border: 1px solid rgba(255,255,255,0.1); }
        .card-silver { background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%); color: #1e293b; border: 1px solid rgba(255,255,255,0.3); }
        .card-gold { background: linear-gradient(135deg, #FCD34D 0%, #D97706 100%); color: #78350f; border: 1px solid rgba(255,255,255,0.3); }
        .card-platinum { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #94a3b8 100%); color: #334155; border: 1px solid white; }
        .card-black { background: linear-gradient(135deg, #18181b 0%, #27272a 100%); color: #FCD34D; border: 1px solid #FCD34D; }
        .card-red { background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%); color: white; }
        
        .animate-fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none;  scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="app" v-cloak class="min-h-screen flex flex-col relative">

    
    <div v-if="loading" class="fixed inset-0 bg-white/95 backdrop-blur-sm z-[9999] flex items-center justify-center transition-opacity duration-300">
        <div class="flex flex-col items-center">
            <img src="https://developers.line.biz/media/line-mini-app/LINE_spinner_light.svg" alt="Loading..." class="w-12 h-12 mb-4 animate-spin">
            <p class="text-sm font-medium text-gray-500 animate-pulse mt-2">{{ loadingText }}</p>
        </div>
    </div>

   
    <div v-if="!loading && isAdmin" class="flex flex-col md:flex-row min-h-screen">
       
        <aside class="hidden md:flex flex-col w-64 bg-white shadow-xl z-10 border-r border-gray-100 h-screen sticky top-0">
            <div class="p-6 flex items-center space-x-3 border-b border-gray-100">
                <div class="bg-line text-white p-2 rounded-lg shadow-lg shadow-green-200"><i class="fa-solid fa-users-gear text-xl"></i></div>
                <h1 class="text-xl font-bold text-gray-800 tracking-tight">CRM Admin</h1>
            </div>
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <button @click="currentTab = 'dashboard'" :class="tabClass('dashboard')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-chart-pie w-6 text-center"></i> <span>Dashboard</span></button>
                <button @click="currentTab = 'customers'" :class="tabClass('customers')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-users w-6 text-center"></i> <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ & ‡πÅ‡∏ï‡πâ‡∏°</span></button>
                <button @click="currentTab = 'segments'" :class="tabClass('segments')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-layer-group w-6 text-center"></i> <span>‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</span></button>
                <button @click="currentTab = 'news'" :class="tabClass('news')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-bullhorn w-6 text-center"></i> <span>‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</span></button>
                <button @click="currentTab = 'settings'" :class="tabClass('settings')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-sliders w-6 text-center"></i> <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö</span></button>
                <button @click="currentTab = 'broadcast'" :class="tabClass('broadcast')" class="w-full text-left p-3 rounded-xl flex items-center space-x-3 transition"><i class="fa-solid fa-paper-plane w-6 text-center"></i> <span>Broadcast</span></button>
            </nav>
            <div class="p-4 border-t border-gray-100 bg-gray-50">
                <div class="flex items-center space-x-3">
                    <img :src="userProfile.pictureUrl" class="w-10 h-10 rounded-full border-2 border-white shadow-sm bg-white">
                    <div class="overflow-hidden">
                        <p class="text-sm font-bold text-gray-700 truncate">{{ userProfile.displayName }}</p>
                        <p class="text-xs text-green-600 font-medium">Admin Mode</p>
                    </div>
                </div>
            </div>
        </aside>

      
        <main class="flex-1 flex flex-col h-screen overflow-hidden relative bg-[#F3F4F6]">
            
            <header class="md:hidden bg-white shadow-sm p-4 flex justify-between items-center z-20 sticky top-0">
                <div class="flex items-center space-x-2"><div class="bg-line text-white w-8 h-8 flex items-center justify-center rounded-lg"><i class="fa-solid fa-leaf"></i></div><h1 class="font-bold text-lg text-gray-800">CRM Admin</h1></div>
                <div class="text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold">Admin</div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 pb-24 md:p-8">
                
              
                <div v-if="currentTab === 'dashboard'" class="space-y-6 animate-fade-in-up">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100"><div class="text-gray-500 text-xs font-bold uppercase mb-2">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div class="text-3xl font-bold text-gray-800">{{ stats.totalCustomers.toLocaleString() }}</div></div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100"><div class="text-gray-500 text-xs font-bold uppercase mb-2">‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏ß‡∏°</div><div class="text-3xl font-bold text-yellow-500">{{ stats.totalPoints.toLocaleString() }}</div></div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100"><div class="text-gray-500 text-xs font-bold uppercase mb-2">VIP Users</div><div class="text-3xl font-bold text-line">{{ stats.vipCount.toLocaleString() }}</div></div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100"><div class="text-gray-500 text-xs font-bold uppercase mb-2">Active (30 ‡∏ß‡∏±‡∏ô)</div><div class="text-3xl font-bold text-blue-500">{{ stats.activeUsersCount.toLocaleString() }}</div></div>
                    </div>
                </div>

               
                <div v-if="currentTab === 'customers'" class="space-y-6 animate-fade-in-up">
                     <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span class="text-sm font-normal text-gray-500">({{ totalItems.toLocaleString() }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</span></h2>
                        <div class="w-full md:w-auto relative">
                            <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                            <input v-model="searchQuery" @input="debouncedSearch" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£..." class="pl-10 border rounded-xl px-4 py-2 w-full md:w-64 focus:ring-2 focus:ring-green-500 outline-none transition">
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden relative min-h-[300px]">
                   
                        <div v-if="tableLoading" class="absolute inset-0 bg-white/80 z-10 flex items-center justify-center">
                            <div class="flex flex-col items-center">
                                <i class="fa-solid fa-circle-notch fa-spin text-line text-2xl mb-2"></i>
                                <span class="text-xs text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                            </div>
                        </div>

                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-600 font-bold uppercase text-xs"><tr><th class="p-3">Profile</th><th class="p-3">Level</th><th class="p-3">Points</th><th class="p-3 hidden md:table-cell">Last Active</th><th class="p-3 text-right">Action</th></tr></thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr v-if="customers.length === 0 && !tableLoading">
                                    <td colspan="5" class="p-8 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</td>
                                </tr>
                                <tr v-for="c in customers" :key="c.id" class="hover:bg-gray-50 transition">
                                    <td class="p-3 flex items-center space-x-2">
                                        <img :src="c.picture_url || 'https://via.placeholder.com/40'" class="w-8 h-8 rounded-full border bg-gray-100 object-cover">
                                        <div class="overflow-hidden">
                                            <div class="font-bold text-gray-800 truncate max-w-[150px]">{{ c.display_name }}</div>
                                            <div class="text-[10px] text-gray-400 truncate">{{ c.phone || c.email || '-' }}</div>
                                        </div>
                                    </td>
                                    <td class="p-3"><span class="bg-gray-100 border px-2 py-0.5 rounded text-[10px] font-bold whitespace-nowrap">{{ calculateTier(c.points).name }}</span></td>
                                    <td class="p-3 font-bold text-blue-600">{{ (c.points||0).toLocaleString() }}</td>
                                    <td class="p-3 text-xs text-gray-400 hidden md:table-cell">{{ formatDate(c.last_activity) }}</td>
                                    <td class="p-3 text-right"><button @click="editCustomer(c)" class="text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition font-medium text-xs">Edit</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                   
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 pt-2 pb-8">
                        <div class="text-xs text-gray-500 flex items-center gap-2">
                            ‡πÅ‡∏™‡∏î‡∏á
                            <select v-model="itemsPerPage" @change="changePageSize" class="border rounded p-1 bg-white focus:outline-none focus:border-green-500">
                                <option :value="10">10</option>
                                <option :value="20">20</option>
                                <option :value="50">50</option>
                                <option :value="100">100</option>
                            </select>
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <button @click="prevPage" :disabled="currentPage === 1" class="px-3 py-1.5 bg-white border rounded-lg text-gray-600 disabled:opacity-50 hover:bg-gray-50 font-medium text-xs transition">
                                <i class="fa-solid fa-chevron-left mr-1"></i> ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                            </button>
                            
                            <div class="flex items-center gap-1 text-xs">
                                <span>‡∏´‡∏ô‡πâ‡∏≤</span>
                                <input type="number" v-model.number="jumpPageInput" @keyup.enter="jumpToPage" class="w-12 text-center border rounded p-1 focus:ring-1 focus:ring-green-500 outline-none" :placeholder="currentPage">
                                <span>/ {{ totalPages }}</span>
                            </div>

                            <button @click="nextPage" :disabled="currentPage === totalPages" class="px-3 py-1.5 bg-white border rounded-lg text-gray-600 disabled:opacity-50 hover:bg-gray-50 font-medium text-xs transition">
                                ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fa-solid fa-chevron-right ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>

               
                <div v-if="currentTab === 'segments'" class="space-y-6 animate-fade-in-up">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-4">
                        <h3 class="font-bold text-gray-700 border-b pb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <input v-model="segmentForm.name" class="border p-2.5 rounded-xl w-full" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ï‡πâ‡∏°)">
                            <div class="flex items-center space-x-2">
                                <label class="text-sm text-gray-600 whitespace-nowrap">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ></label>
                                <input v-model.number="segmentForm.min_days_joined" type="number" class="border p-2.5 rounded-xl w-20 text-center" placeholder="30">
                                <span class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm text-gray-600 whitespace-nowrap">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏° <</label>
                                <input v-model.number="segmentForm.max_points" type="number" class="border p-2.5 rounded-xl w-20 text-center" placeholder="0">
                                <span class="text-sm text-gray-600">‡πÅ‡∏ï‡πâ‡∏°</span>
                            </div>
                             <div class="flex items-center space-x-2">
                                <label class="text-sm text-gray-600 whitespace-nowrap">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ></label>
                                <input v-model.number="segmentForm.inactive_days" type="number" class="border p-2.5 rounded-xl w-20 text-center" placeholder="0">
                                <span class="text-sm text-gray-600">‡∏ß‡∏±‡∏ô</span>
                            </div>
                        </div>
                        <button @click="createSegment" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow hover:bg-blue-700 transition">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-500 font-bold uppercase text-xs"><tr><th class="p-4">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th class="p-4">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</th><th class="p-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr v-for="seg in segments" :key="seg.id" class="hover:bg-gray-50">
                                    <td class="p-4 font-bold text-gray-800">{{ seg.name }}</td>
                                    <td class="p-4 text-xs text-gray-500">
                                        <span v-if="seg.conditions.min_days_joined" class="bg-blue-50 text-blue-600 px-2 py-1 rounded mr-1">Old > {{ seg.conditions.min_days_joined }}d</span>
                                        <span v-if="seg.conditions.max_points !== undefined" class="bg-yellow-50 text-yellow-600 px-2 py-1 rounded mr-1">Points < {{ seg.conditions.max_points }}</span>
                                        <span v-if="seg.conditions.inactive_days" class="bg-red-50 text-red-600 px-2 py-1 rounded mr-1">Inactive > {{ seg.conditions.inactive_days }}d</span>
                                    </td>
                                    <td class="p-4 text-right"><button @click="deleteSegment(seg.id)" class="text-red-400 hover:text-red-600 bg-red-50 p-2 rounded-lg transition"><i class="fa-solid fa-trash"></i></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

               
                <div v-if="currentTab === 'news'" class="space-y-6 animate-fade-in-up">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <input v-model="newsForm.title" class="w-full border p-2.5 rounded-xl focus:ring-2 focus:ring-green-400 outline-none" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß">
                                <textarea v-model="newsForm.description" class="w-full border p-2.5 rounded-xl focus:ring-2 focus:ring-green-400 outline-none" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..."></textarea>
                            </div>
                            <div class="space-y-3">
                                <input v-model="newsForm.image_url" class="w-full border p-2.5 rounded-xl focus:ring-2 focus:ring-green-400 outline-none" placeholder="URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
                                <div class="p-3 border border-dashed border-gray-300 rounded-xl bg-gray-50">
                                    <p class="text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider">Call to Action Button</p>
                                    <input v-model="newsForm.link_url" class="w-full border p-2 rounded-lg text-sm mb-2" placeholder="URL ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á">
                                    <input v-model="newsForm.link_text" class="w-full border p-2 rounded-lg text-sm" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏° (‡πÄ‡∏ä‡πà‡∏ô '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏¢')">
                                </div>
                            </div>
                        </div>
                        <button @click="createNews" class="w-full bg-line text-white py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-600 transition transform hover:scale-[1.01] active:scale-95">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</button>
                    </div>
                    <div class="grid gap-4 md:grid-cols-2">
                        <div v-for="news in newsList" :key="news.id" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4 hover:shadow-md transition">
                            <img :src="news.image_url || 'https://via.placeholder.com/100'" class="w-24 h-24 object-cover rounded-xl bg-gray-100 flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-bold text-gray-800 truncate mb-1">{{ news.title }}</h4>
                                <p class="text-sm text-gray-500 line-clamp-2">{{ news.description }}</p>
                                <div v-if="news.link_url" class="mt-2 inline-flex items-center text-xs text-blue-500 bg-blue-50 px-2 py-1 rounded-md font-medium"><i class="fa-solid fa-link mr-1"></i> {{ news.link_text || 'Link' }}</div>
                            </div>
                            <button @click="deleteNews(news.id)" class="text-gray-300 hover:text-red-500 self-start p-1 transition"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>

               
                <div v-if="currentTab === 'settings'" class="space-y-6 animate-fade-in-up">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-gray-800">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Tiers)</h2>
                        <button @click="addTier" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-green-700 transition"><i class="fa-solid fa-plus mr-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-600"><tr><th class="p-4">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö</th><th class="p-4">‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</th><th class="p-4">‡∏ò‡∏µ‡∏°‡∏™‡∏µ</th><th class="p-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                            <tbody class="divide-y">
                                <tr v-for="(tier, index) in tiers" :key="tier.id" class="hover:bg-gray-50">
                                    <td class="p-4"><input v-model="tier.name" class="border p-2 rounded w-full max-w-[150px]" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Tier"></td>
                                    <td class="p-4"><input v-model.number="tier.min_points" type="number" class="border p-2 rounded w-24" placeholder="0"></td>
                                    <td class="p-4">
                                        <select v-model="tier.color_theme" class="border p-2 rounded w-full max-w-[150px]">
                                            <option value="card-member">üîµ Default</option>
                                            <option value="card-silver">‚ö™ Silver</option>
                                            <option value="card-gold">üü° Gold</option>
                                            <option value="card-platinum">üíé Platinum</option>
                                            <option value="card-black">‚ö´ Black</option>
                                            <option value="card-red">üî¥ Red</option>
                                        </select>
                                    </td>
                                    <td class="p-4 text-right"><button @click="removeTier(index, tier.id)" class="text-red-500 hover:underline"><i class="fa-solid fa-trash"></i> ‡∏•‡∏ö</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-end"><button @click="saveTiers" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-blue-700 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button></div>
                </div>

               
                <div v-if="currentTab === 'broadcast'" class="space-y-6 animate-fade-in-up">
                    <h2 class="text-2xl font-bold text-gray-800">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (Broadcast)</h2>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-5">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</label>
                            <select v-model="broadcastTarget" class="w-full border p-3 rounded-xl bg-gray-50 focus:ring-2 focus:ring-green-500 outline-none">
                                <option value="all">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ({{ stats.totalCustomers }})</option>
                                <optgroup label="üéØ ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Segments)">
                                    <option v-for="seg in segments" :key="seg.id" :value="'segment:' + seg.id">üìå {{ seg.name }}</option>
                                </optgroup>
                                <optgroup label="üè∑Ô∏è ‡∏™‡πà‡∏á‡∏ï‡∏≤‡∏° Tags">
                                    <option v-for="tag in uniqueTags" :key="tag" :value="'tag:' + tag"># {{ tag }}</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">2. ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                            <div class="flex space-x-2 bg-gray-100 p-1 rounded-xl">
                                <button @click="msgType = 'text'" :class="msgType === 'text' ? 'bg-white text-gray-800 shadow-sm' : 'text-gray-500 hover:bg-gray-200'" class="flex-1 py-2 rounded-lg font-bold text-sm transition duration-200"><i class="fa-solid fa-comment-dots mr-2"></i> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                                <button @click="msgType = 'image'" :class="msgType === 'image' ? 'bg-white text-gray-800 shadow-sm' : 'text-gray-500 hover:bg-gray-200'" class="flex-1 py-2 rounded-lg font-bold text-sm transition duration-200"><i class="fa-solid fa-image mr-2"></i> ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                                <button @click="msgType = 'flex'" :class="msgType === 'flex' ? 'bg-white text-gray-800 shadow-sm' : 'text-gray-500 hover:bg-gray-200'" class="flex-1 py-2 rounded-lg font-bold text-sm transition duration-200"><i class="fa-solid fa-code mr-2"></i> Flex Msg</button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div v-if="msgType === 'text'">
                                <textarea v-model="messageText" class="w-full border border-gray-200 p-3 rounded-xl h-32 focus:ring-2 focus:ring-green-500 outline-none resize-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..."></textarea>
                            </div>
                            <div v-if="msgType === 'image'">
                                <input v-model="broadcastImageUrl" class="w-full border border-gray-200 p-3 rounded-xl focus:ring-2 focus:ring-green-500 outline-none" placeholder="https://example.com/image.jpg">
                                <div v-if="broadcastImageUrl" class="mt-2 rounded-xl overflow-hidden border border-gray-200 shadow-sm"><img :src="broadcastImageUrl" class="max-h-48 object-cover w-full"></div>
                            </div>
                            <div v-if="msgType === 'flex'">
                                <textarea v-model="broadcastFlexJson" class="w-full border border-gray-200 p-3 rounded-xl h-48 font-mono text-xs bg-gray-50 focus:ring-2 focus:ring-green-500 outline-none" placeholder='{ "type": "bubble", ... }'></textarea>
                            </div>
                        </div>
                        <button @click="sendBroadcast" :disabled="sending" class="w-full bg-gray-900 text-white py-3.5 rounded-xl font-bold shadow-lg flex justify-center items-center hover:bg-black transition">
                            <span v-if="sending"><i class="fa-solid fa-circle-notch fa-spin mr-2"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>
                            <span v-else><i class="fa-solid fa-paper-plane mr-2"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</span>
                        </button>
                    </div>
                </div>

            </div>

           
            <nav class="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex items-center justify-between px-2 pb-safe z-30 overflow-x-auto no-scrollbar shadow-[0_-4px_10px_rgba(0,0,0,0.03)]">
                <button @click="currentTab = 'dashboard'" :class="navClass('dashboard')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-chart-pie text-lg"></i><span class="text-[9px] mt-1">Dash</span></button>
                <button @click="currentTab = 'customers'" :class="navClass('customers')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-users text-lg"></i><span class="text-[9px] mt-1">Users</span></button>
                <button @click="currentTab = 'segments'" :class="navClass('segments')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-layer-group text-lg"></i><span class="text-[9px] mt-1">Group</span></button>
                <button @click="currentTab = 'news'" :class="navClass('news')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-bullhorn text-lg"></i><span class="text-[9px] mt-1">News</span></button>
                <button @click="currentTab = 'settings'" :class="navClass('settings')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-sliders text-lg"></i><span class="text-[9px] mt-1">Tier</span></button>
                <button @click="currentTab = 'broadcast'" :class="navClass('broadcast')" class="flex flex-col items-center p-2 min-w-[60px]"><i class="fa-solid fa-paper-plane text-lg"></i><span class="text-[9px] mt-1">Send</span></button>
            </nav>
        </main>
    </div>

   
    <div v-else-if="!loading && !isAdmin" class="flex flex-col min-h-screen bg-gray-50 pb-safe">
        
     
        <header class="bg-white px-6 pt-8 pb-16 rounded-b-[40px] shadow-sm relative z-10">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-gray-400 text-xs font-medium mb-1">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì,</p>
                    <h1 class="text-2xl font-bold text-gray-800 tracking-tight">{{ userProfile?.displayName }}</h1>
                </div>
                <div class="relative">
                    <img :src="userProfile?.pictureUrl" class="w-12 h-12 rounded-full border-2 border-white shadow-md object-cover bg-gray-100">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>
                </div>
            </div>
        </header>

       
        <div class="px-5 -mt-10 z-20 w-full max-w-md mx-auto">
            <div :class="currentTierObj.color_theme" class="rounded-3xl shadow-xl p-6 relative overflow-hidden h-52 flex flex-col justify-between transition-all duration-500 transform hover:scale-[1.01]">
                <button @click.stop="shareMyTier" class="absolute top-4 right-4 bg-white/20 backdrop-blur-md text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-white/30 transition z-20 shadow-sm border border-white/10 active:scale-95"><i class="fa-solid fa-share-nodes text-sm"></i></button>
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-black opacity-5 rounded-full blur-2xl"></div>
                <div class="flex justify-between items-start z-10"><div><div class="flex items-center space-x-2"><i class="fa-solid fa-id-card opacity-70"></i><span class="text-xs opacity-70 uppercase tracking-widest font-bold">Member Card</span></div><h2 class="text-2xl font-extrabold mt-1 uppercase tracking-wider drop-shadow-sm">{{ currentTierObj.name }}</h2></div></div>
                <div class="z-10">
                    <div class="flex justify-between items-end mb-2">
                        <div><p class="text-[10px] opacity-70 uppercase mb-0.5">Points Balance</p><p class="text-4xl font-mono font-bold tracking-tight drop-shadow-sm">{{ (memberData?.points || 0).toLocaleString() }}</p></div>
                    </div>
                    <div v-if="nextTier" class="mt-1"><div class="flex justify-between text-[9px] opacity-90 mb-1 font-medium"><span>Next Level: {{ nextTier.name }}</span><span>{{ (memberData?.points || 0).toLocaleString() }} / {{ nextTier.min_points.toLocaleString() }}</span></div><div class="w-full bg-black/20 h-1.5 rounded-full overflow-hidden backdrop-blur-sm"><div class="bg-white/90 h-full transition-all duration-1000 ease-out shadow-[0_0_10px_rgba(255,255,255,0.5)]" :style="`width: ${nextTierProgress}%`"></div></div></div>
                    <div v-else class="mt-2 text-[10px] opacity-80 text-center font-medium bg-white/10 py-1 rounded-lg">‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</div>
                </div>
            </div>
        </div>

     
        <div class="flex-1 px-5 pt-6 pb-8 space-y-5 max-w-md mx-auto w-full">
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 animate-fade-in-up" style="animation-delay: 0.1s;">
                <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-50">
                    <h3 class="font-bold text-gray-800 flex items-center text-sm"><i class="fa-solid fa-user-circle mr-2 text-line text-lg"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                    <button @click="openMemberEdit" class="text-xs text-gray-500 font-medium hover:text-line transition"><i class="fa-solid fa-pen mr-1"></i>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
                <div class="space-y-3 text-sm">
                    <div class="flex items-center justify-between"><span class="text-gray-400 text-xs flex items-center"><i class="fa-solid fa-phone w-5"></i> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</span><span class="font-medium text-gray-700">{{ memberData?.phone || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span></div>
                    <div class="flex items-center justify-between"><span class="text-gray-400 text-xs flex items-center"><i class="fa-solid fa-envelope w-5"></i> ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</span><span class="font-medium text-gray-700 truncate max-w-[180px]">{{ memberData?.email || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏' }}</span></div>
                </div>
            </div>
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 animate-fade-in-up" style="animation-delay: 0.2s;">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center text-sm"><i class="fa-solid fa-bullhorn mr-2 text-red-500 text-lg"></i> ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô & ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h3>
                <div v-if="newsList.length === 0" class="text-center py-6"><i class="fa-regular fa-newspaper text-3xl text-gray-200 mb-2"></i><p class="text-gray-400 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p></div>
                <div v-else class="space-y-4">
                    <div v-for="news in newsList" :key="news.id" class="group relative">
                        <div @click="openNewsDetail(news)" class="cursor-pointer">
                            <div class="relative overflow-hidden rounded-xl mb-3 shadow-sm"><img v-if="news.image_url" :src="news.image_url" class="w-full h-36 object-cover transform group-hover:scale-105 transition duration-500"><div class="absolute top-2 right-2"><span class="bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm">New</span></div></div>
                            <h4 class="font-bold text-gray-800 text-sm mb-1 group-hover:text-line transition line-clamp-1 pr-8">{{ news.title }}</h4><p class="text-xs text-gray-500 line-clamp-2 leading-relaxed">{{ news.description }}</p>
                        </div>
                        <button @click.stop="shareNews(news)" class="absolute bottom-2 right-0 bg-gray-50 text-gray-400 hover:text-line hover:bg-green-50 w-8 h-8 rounded-full flex items-center justify-center transition border border-gray-200 shadow-sm active:scale-90"><i class="fa-solid fa-share text-xs"></i></button>
                    </div>
                </div>
            </div>
             <button @click="openChatWindow" class="w-full bg-white py-4 rounded-2xl shadow-sm text-line font-bold border border-green-100 flex items-center justify-center space-x-2 active:bg-green-50 hover:bg-green-50 transition transform active:scale-95 animate-fade-in-up" style="animation-delay: 0.3s;">
                <i class="fa-brands fa-line text-2xl"></i><span>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
            </button>
            <p class="text-center text-[10px] text-gray-300 pt-4">CRM Pro System v3.6</p>
        </div>
    </div>


    <div v-if="editingCustomer" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-2xl transform transition-all scale-100">
            <div class="flex justify-between items-center mb-6"><h3 class="text-xl font-bold text-gray-800">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3><button @click="editingCustomer = null" class="text-gray-400 hover:text-gray-600 bg-gray-100 w-8 h-8 rounded-full"><i class="fa-solid fa-xmark"></i></button></div>
            <div class="space-y-4 max-h-[70vh] overflow-y-auto pr-1 custom-scrollbar">
                <div class="space-y-3">
                    <div><label class="block text-xs font-bold text-gray-500 mb-1">‡∏ä‡∏∑‡πà‡∏≠</label><input v-model="editingCustomer.display_name" class="w-full border border-gray-200 p-2.5 rounded-xl bg-gray-50 focus:bg-white transition outline-none focus:ring-2 focus:ring-green-500"></div>
                    <div><label class="block text-xs font-bold text-gray-500 mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input v-model="editingCustomer.phone" class="w-full border border-gray-200 p-2.5 rounded-xl bg-gray-50 focus:bg-white transition outline-none focus:ring-2 focus:ring-green-500"></div>
                    <div><label class="block text-xs font-bold text-gray-500 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input v-model="editingCustomer.email" class="w-full border border-gray-200 p-2.5 rounded-xl bg-gray-50 focus:bg-white transition outline-none focus:ring-2 focus:ring-green-500"></div>
                </div>
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100">
                    <div class="flex items-center justify-between mb-3">
                        <!-- Changed static text to input -->
                        <div class="flex items-center">
                             <input v-model.number="editingCustomer.points" type="number" class="text-2xl font-bold text-gray-800 w-32 bg-white border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-orange-500 outline-none mr-2">
                             <span class="text-xs font-normal text-gray-500">‡πÅ‡∏ï‡πâ‡∏°</span>
                        </div>
                        <span class="text-xs bg-white border border-orange-200 px-2 py-1 rounded font-bold text-orange-600">{{ calculateTier(editingCustomer.points).name }}</span>
                    </div>
                    <div class="flex space-x-2">
                        <button @click="adjustPoints(-100)" class="flex-1 bg-white border border-red-200 text-red-600 py-1.5 rounded-lg text-xs font-bold shadow-sm hover:bg-red-50">-100</button>
                        <button @click="adjustPoints(-10)" class="flex-1 bg-white border border-red-200 text-red-600 py-1.5 rounded-lg text-xs font-bold shadow-sm hover:bg-red-50">-10</button>
                        <button @click="adjustPoints(10)" class="flex-1 bg-white border border-green-200 text-green-600 py-1.5 rounded-lg text-xs font-bold shadow-sm hover:bg-green-50">+10</button>
                        <button @click="adjustPoints(100)" class="flex-1 bg-white border border-green-200 text-green-600 py-1.5 rounded-lg text-xs font-bold shadow-sm hover:bg-green-50">+100</button>
                    </div>
                </div>
                <div><label class="block text-xs font-bold text-gray-500 mb-1">Tags</label><input v-model="editingTagsInput" class="w-full border border-gray-200 p-2.5 rounded-xl bg-gray-50" placeholder="vip, new"></div>
            </div>
            <div class="flex space-x-3 mt-6 pt-4 border-t border-gray-100"><button @click="saveCustomer" class="flex-1 bg-gray-900 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-black transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>
        </div>
    </div>

 
    <div v-if="selectedNews" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-up" @click.self="selectedNews = null">
        <div class="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl relative">
            <button @click="selectedNews = null" class="absolute top-4 right-4 bg-black/30 backdrop-blur-md text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-black/50 z-10 transition"><i class="fa-solid fa-xmark"></i></button>
            <div class="relative"><img :src="selectedNews.image_url || 'https://via.placeholder.com/600x400'" class="w-full h-64 object-cover"><div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-white to-transparent"></div></div>
            <div class="p-6 -mt-10 relative">
                <h3 class="text-2xl font-bold text-gray-800 mb-3 leading-tight">{{ selectedNews.title }}</h3><p class="text-gray-600 text-sm leading-relaxed mb-8">{{ selectedNews.description }}</p>
                <div class="space-y-3">
                    <a v-if="selectedNews.link_url" :href="selectedNews.link_url" target="_blank" class="block w-full bg-line text-white text-center py-3.5 rounded-2xl font-bold shadow-lg shadow-green-200 hover:bg-green-600 transition flex items-center justify-center transform active:scale-95"><span>{{ selectedNews.link_text || '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î' }}</span> <i class="fa-solid fa-arrow-right ml-2"></i></a>
                    <button @click="shareNews(selectedNews)" class="block w-full bg-gray-100 text-gray-700 text-center py-3.5 rounded-2xl font-bold hover:bg-gray-200 transition flex items-center justify-center"><i class="fa-solid fa-share mr-2"></i> ‡πÅ‡∏ä‡∏£‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</button>
                </div>
            </div>
        </div>
    </div>

   
    <div v-if="memberEditing" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl animate-fade-in-up">
            <h3 class="font-bold mb-6 text-gray-800 text-lg border-b pb-2">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
            <div class="space-y-4">
                <div>
  <label class="block text-xs font-bold text-gray-500 mb-1 ml-1">
    ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
  </label>

  <input
    v-model="memberEditForm.phone"
    type="tel"
    inputmode="numeric"
    pattern="[0-9]*"
    maxlength="10"
    placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ 10 ‡∏´‡∏•‡∏±‡∏Å"
    class="w-full border border-gray-200 p-3 rounded-xl bg-gray-50
           focus:bg-white focus:ring-2 focus:ring-green-500
           outline-none transition"
    @input="onPhoneInput"
  />
</div>

                <div><label class="block text-xs font-bold text-gray-500 mb-1 ml-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label><input v-model="memberEditForm.email" type="email" class="w-full border border-gray-200 p-3 rounded-xl bg-gray-50 focus:bg-white focus:ring-2 focus:ring-green-500 outline-none transition"></div>
            </div>
            <div class="flex space-x-3 mt-8"><button @click="memberEditing = false" class="flex-1 bg-gray-100 text-gray-600 py-3 rounded-xl font-bold hover:bg-gray-200 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button @click="saveMemberProfile" class="flex-1 bg-line text-white py-3 rounded-xl font-bold shadow-lg shadow-green-200 hover:bg-green-600 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;
    const { createClient } = supabase;

    // --- CONFIG ---
    const LIFF_ID = "2008759540-y8p3YhuB"; 
    const SUPABASE_URL = "https://ctcsdjjmhydtsmbabzmy.supabase.co"; 
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0Y3NkamptaHlkdHNtYmFiem15Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1MDU4MzgsImV4cCI6MjA4MjA4MTgzOH0.yZSsAlg0RXuu_4NiLNi9VVbwz0Koq2y3c4ytbtGPamw"; 

    const showAlert = (title, text, icon = 'success') => Swal.fire({ title, text, icon, confirmButtonColor: '#06C755' });

    createApp({
        data() {
            return {
                loading: true,
                loadingText: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
                isAdmin: false,
                
               
                userProfile: null, memberData: null,
                customers: [], 
                segments: [], tiers: [], newsList: [],
                uniqueTags: [], 
                
                
                currentPage: 1, itemsPerPage: 10, totalItems: 0, searchQuery: '', tableLoading: false,
                
                
                stats: { totalCustomers: 0, totalPoints: 0, vipCount: 0, activeUsersCount: 0 },

                
                currentTab: 'dashboard',
                broadcastTarget: 'all', msgType: 'text', messageText: '', broadcastImageUrl: '', broadcastFlexJson: '',
                newsForm: { title: '', description: '', image_url: '', link_url: '', link_text: '' },
                segmentForm: { name: '', min_days_joined: null, max_points: null, inactive_days: null },
                
                sending: false, editingCustomer: null, editingTagsInput: '',
                
                
                selectedNews: null, memberEditing: false, memberEditForm: { phone: '', email: '' },
                
                supabase: null
            }
        },
        computed: {
            totalPages() { return Math.ceil(this.totalItems / this.itemsPerPage) || 1; },
            nextTier() {
                const currentPoints = this.memberData?.points || 0;
                const sortedAsc = [...this.tiers].sort((a,b) => a.min_points - b.min_points);
                return sortedAsc.find(t => t.min_points > currentPoints);
            },
            nextTierProgress() {
                if (!this.nextTier) return 100;
                const current = this.memberData?.points || 0;
                return Math.min(100, Math.max(0, (current / this.nextTier.min_points) * 100));
            },
            currentTierObj() { return this.calculateTier(this.memberData?.points); },
            
        },
        created() {
            this.debouncedSearch = _.debounce(() => { this.currentPage = 1; this.fetchCustomers(); }, 500);
        },
        async mounted() {
            this.supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
            await this.fetchTiers();
            await this.fetchNews();
            
            try {
                await liff.init({ liffId: LIFF_ID, withLoginOnExternalBrowser: true });
                await liff.ready;
                if(!liff.isLoggedIn()) {
                    liff.login({ scope: 'profile openid email' });
                } else {
                    await this.handleLogin();
                }
            } catch(e) { 
                console.error("LIFF Init Error", e);
                Swal.fire("Error", "LIFF Init Failed. Please reload.", "error");
                this.loading = false;
            }
        },
        methods: {
            tabClass(tab) { return this.currentTab === tab ? 'bg-green-50 text-line font-bold' : ''; },
            navClass(tab) { return this.currentTab === tab ? 'text-line' : 'text-gray-400'; },
            formatDate(d) { return d ? new Date(d).toLocaleDateString('th-TH') : '-'; },
            
            async handleLogin() {
                const profile = await liff.getProfile();
                this.userProfile = profile;
                
                let lineEmail = null;
                try {
                    const idToken = liff.getDecodedIDToken();
                    if (idToken && idToken.email) lineEmail = idToken.email;
                } catch (e) { console.warn("Email scope error", e); }

                await this.syncAndCheckRole(profile, lineEmail);
                this.loading = false;
            },
            
            async syncAndCheckRole(profile, lineEmail) {
                let { data: user } = await this.supabase.from('profiles').select('*').eq('line_user_id', profile.userId).maybeSingle();
                const now = new Date();
                
                if (!user) {
                    const newUser = { 
                        line_user_id: profile.userId, 
                        display_name: profile.displayName, 
                        picture_url: profile.pictureUrl, 
                        email: lineEmail, 
                        role: 'member', 
                        last_activity: now,
                        points: 0,
                        tags: ['new']
                    };
                    const { data: inserted, error } = await this.supabase.from('profiles').insert(newUser).select().maybeSingle();
                    if (!error) {
                        user = inserted;
                        this.supabase.functions.invoke('crm-core', { body: { action: 'notify-telegram', message: `‚ú® New Member: ${profile.displayName}\nEmail: ${lineEmail || '-'}` } });
                    }
                } else {
                    const updates = { display_name: profile.displayName, picture_url: profile.pictureUrl, last_activity: now };
                    if ((!user.email || user.email === '') && lineEmail) { updates.email = lineEmail; user.email = lineEmail; }
                    await this.supabase.from('profiles').update(updates).eq('line_user_id', profile.userId);
                }
                
                this.memberData = user;
                if (user && user.role === 'admin') {
                    this.isAdmin = true;
                    this.fetchDashboardStats();
                    this.fetchCustomers();
                    this.fetchSegments();
                    this.fetchUniqueTags(); 
                }
            },

           
            async fetchCustomers() {
                this.tableLoading = true;
                const start = (this.currentPage - 1) * this.itemsPerPage;
                const end = start + this.itemsPerPage - 1;
                let query = this.supabase.from('profiles').select('*', { count: 'exact' }).order('created_at', { ascending: false }).range(start, end);
                if (this.searchQuery) query = query.or(`display_name.ilike.%${this.searchQuery}%,phone.ilike.%${this.searchQuery}%`);
                const { data, count, error } = await query;
                if (!error) { this.customers = data; this.totalItems = count; }
                this.tableLoading = false;
            },
            prevPage() { if (this.currentPage > 1) { this.currentPage--; this.fetchCustomers(); } },
            nextPage() { if (this.currentPage < this.totalPages) { this.currentPage++; this.fetchCustomers(); } },
            changePageSize() { this.currentPage = 1; this.fetchCustomers(); },
            jumpToPage() { if(this.jumpPageInput >= 1 && this.jumpPageInput <= this.totalPages) { this.currentPage = this.jumpPageInput; this.fetchCustomers(); } },

           
            async fetchDashboardStats() {
                const { count: total } = await this.supabase.from('profiles').select('*', { count: 'exact', head: true });
                this.stats.totalCustomers = total || 0;
                const { count: vip } = await this.supabase.from('profiles').select('*', { count: 'exact', head: true }).contains('tags', ['vip']);
                this.stats.vipCount = vip || 0;
                const d = new Date(); d.setDate(d.getDate() - 30);
                const { count: active } = await this.supabase.from('profiles').select('*', { count: 'exact', head: true }).gt('last_activity', d.toISOString());
                this.stats.activeUsersCount = active || 0;
                const { data: pointsData } = await this.supabase.from('profiles').select('points').limit(1000);
                this.stats.totalPoints = pointsData?.reduce((acc, curr) => acc + (curr.points || 0), 0) || 0;
            },
            
           
            async fetchUniqueTags() {
                
                const { data } = await this.supabase.from('profiles').select('tags').limit(1000);
                if (data) {
                    const allTags = data.flatMap(c => c.tags || []);
                    this.uniqueTags = [...new Set(allTags)];
                }
            },


            
            async fetchSegments() { const { data } = await this.supabase.from('customer_segments').select('*'); if(data) this.segments = data; },
            async createSegment() {
                if(!this.segmentForm.name) return showAlert("Alert", "‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö", "warning");
                const conditions = {};
                if(this.segmentForm.min_days_joined) conditions.min_days_joined = this.segmentForm.min_days_joined;
                if(this.segmentForm.max_points !== null && this.segmentForm.max_points !== "") conditions.max_points = this.segmentForm.max_points;
                if(this.segmentForm.inactive_days) conditions.inactive_days = this.segmentForm.inactive_days;
                const { error } = await this.supabase.from('customer_segments').insert({ name: this.segmentForm.name, conditions: conditions });
                if(!error) { showAlert("Success", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß"); this.fetchSegments(); } else { showAlert("Error", error.message, "error"); }
            },
            async deleteSegment(id) {
                if(!confirm("Delete?")) return;
                await this.supabase.from('customer_segments').delete().eq('id', id);
                this.fetchSegments();
            },

           
            async sendBroadcast() {
                if(!this.messageText && this.msgType === 'text') return showAlert("Alert", "‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô", "warning");
                this.sending = true;
                const { data, error } = await this.supabase.functions.invoke('crm-core', {
                    body: { action: 'broadcast', target: this.broadcastTarget, msgType: this.msgType, message: this.messageText, flexJson: this.broadcastFlexJson, imageUrl: this.broadcastImageUrl }
                });
                this.sending = false;
                if(!error) { showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß: " + (data.message || 'OK')); if (this.msgType === 'text') this.messageText = ''; } 
                else { showAlert("Error", error.message, "error"); }
            },

            
            async fetchTiers() { const { data } = await this.supabase.from('tiers').select('*').order('min_points', { ascending: false }); if (data && data.length > 0) this.tiers = data; else this.tiers = [{name:'Member', min_points:0, color_theme:'card-member'}]; },
            calculateTier(points) { 
                if (!points) points = 0;
                const sorted = [...this.tiers].sort((a,b) => b.min_points - a.min_points);
                for (const t of sorted) { if (points >= t.min_points) return t; }
                return { name: 'Member', color_theme: 'card-member' };
            },
            getTierHexColor(themeClass) { const map = { 'card-member': '#1e293b', 'card-silver': '#94a3b8', 'card-gold': '#D97706', 'card-platinum': '#334155', 'card-black': '#000000', 'card-red': '#b91c1c' }; return map[themeClass] || '#06C755'; },
            
            
            async fetchNews() { const { data } = await this.supabase.from('news_promotions').select('*').order('created_at', { ascending: false }); if (data) this.newsList = data; },
            async createNews() {
                if (!this.newsForm.title) return showAlert("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß", "warning");
                this.loading = true;
                const { error } = await this.supabase.from('news_promotions').insert(this.newsForm);
                this.loading = false;
                if (!error) { showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); this.newsForm = { title: '', description: '', image_url: '', link_url: '', link_text: '' }; this.fetchNews(); }
                else { showAlert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message, "error"); }
            },
            async deleteNews(id) {
                const result = await Swal.fire({ title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?", icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡∏ö', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' });
                if (!result.isConfirmed) return;
                const { error } = await this.supabase.from('news_promotions').delete().eq('id', id);
                if (!error) this.fetchNews();
            },

            
            addTier() { this.tiers.unshift({ id: 'new_' + Date.now(), name: 'New Tier', min_points: 0, color_theme: 'card-member' }); },
            async removeTier(index, id) { if(!confirm("‡∏•‡∏ö?")) return; this.tiers.splice(index, 1); if (!id.toString().startsWith('new_')) await this.supabase.from('tiers').delete().eq('id', id); },
            async saveTiers() {
                this.loading = true;
                const newTiers = this.tiers.filter(t => t.id.toString().startsWith('new_')).map(t => ({ name: t.name, min_points: t.min_points, color_theme: t.color_theme }));
                const existingTiers = this.tiers.filter(t => !t.id.toString().startsWith('new_')).map(t => ({ id: t.id, name: t.name, min_points: t.min_points, color_theme: t.color_theme }));
                try { if (newTiers.length > 0) await this.supabase.from('tiers').insert(newTiers); if (existingTiers.length > 0) await this.supabase.from('tiers').upsert(existingTiers); await this.fetchTiers(); showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); } catch (e) { showAlert("Error", e.message, "error"); } finally { this.loading = false; }
            },
            editCustomer(c) { this.editingCustomer = { ...c, points: c.points || 0 }; this.editingTagsInput = (c.tags || []).join(', '); },
            adjustPoints(amount) { if (this.editingCustomer) { this.editingCustomer.points = (this.editingCustomer.points || 0) + amount; if (this.editingCustomer.points < 0) this.editingCustomer.points = 0; } },
            async saveCustomer() {
                if(!this.editingCustomer) return;
                this.loading = true;
                const tags = this.editingTagsInput.split(',').map(t=>t.trim()).filter(t=>t);
                const updates = { display_name: this.editingCustomer.display_name, phone: this.editingCustomer.phone, email: this.editingCustomer.email, points: this.editingCustomer.points, tags: tags };
                const { error } = await this.supabase.from('profiles').update(updates).eq('id', this.editingCustomer.id);
                this.loading = false;
                if(!error) { showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); this.fetchCustomers(); this.editingCustomer = null; } else { showAlert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message, "error"); }
            },

           
            openMemberEdit() { if (!this.memberData) return; this.memberEditForm = { phone: this.memberData.phone || '', email: this.memberData.email || '' }; this.memberEditing = true; },
            onPhoneInput(e) { let value = e.target.value.replace(/\D/g, ''); if (value.length > 10) value = value.slice(0, 10); this.memberEditForm.phone = value; e.target.value = value; },
            async saveMemberProfile() {
                if (this.memberEditForm.phone && this.memberEditForm.phone.length !== 10) return showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å", "warning");
                this.loading = true;
                const { error } = await this.supabase.from('profiles').update({ phone: this.memberEditForm.phone, email: this.memberEditForm.email }).eq('line_user_id', this.userProfile.userId);
                this.loading = false;
                if (!error) { showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); this.memberData.phone = this.memberEditForm.phone; this.memberData.email = this.memberEditForm.email; this.memberEditing = false; } else { showAlert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", error.message, "error"); }
            },
            openNewsDetail(news) { this.selectedNews = news; },
            openChatWindow() { window.location.href = "https://line.me/R/oaMessage/@779xtjjf/?‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤"; },
            async shareMyTier() {
                if (!liff.isApiAvailable('shareTargetPicker')) return showAlert("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå", "warning");
                const tierName = this.currentTierObj.name; const points = (this.memberData?.points || 0).toLocaleString(); const tierColor = this.getTierHexColor(this.currentTierObj.color_theme);
                const flexMessage = { type: "flex", altText: `‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${tierName}`, contents: { "type": "bubble", "size": "mega", "header": { "type": "box", "layout": "vertical", "contents": [{ "type": "text", "text": "MEMBER CARD", "color": "#ffffff", "weight": "bold", "size": "xs", "align": "center" }], "backgroundColor": tierColor, "paddingAll": "10px" }, "body": { "type": "box", "layout": "vertical", "contents": [{ "type": "text", "text": tierName, "weight": "bold", "size": "3xl", "color": tierColor, "align": "center", "margin": "md" }, { "type": "text", "text": `${points} Points`, "size": "md", "color": "#888888", "align": "center" }], "paddingAll": "20px" }, "footer": { "type": "box", "layout": "vertical", "contents": [{ "type": "button", "action": { "type": "uri", "label": "‡∏î‡∏π‡∏ö‡∏±‡∏ï‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å", "uri": "https://liff.line.me/" + LIFF_ID }, "style": "primary", "color": tierColor }] } } };
                try { await liff.shareTargetPicker([flexMessage]); } catch (e) { showAlert("Error", "‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", "error"); }
            },
            async shareNews(news) {
                if (!liff.isApiAvailable('shareTargetPicker')) return showAlert("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå", "warning");
                const flexMessage = { type: "flex", altText: news.title, contents: { "type": "bubble", "hero": { "type": "image", "url": news.image_url || 'https://via.placeholder.com/600x400', "size": "full", "aspectRatio": "20:13", "aspectMode": "cover" }, "body": { "type": "box", "layout": "vertical", "contents": [{ "type": "text", "text": news.title, "weight": "bold", "size": "xl", "wrap": true }, { "type": "text", "text": news.description || '', "size": "sm", "color": "#666666", "wrap": true, "margin": "md", "maxLines": 3 }] }, "footer": { "type": "box", "layout": "vertical", "contents": [{ "type": "button", "action": { "type": "uri", "label": news.link_text || "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î", "uri": news.link_url || ("https://liff.line.me/" + LIFF_ID) }, "style": "primary", "color": "#06C755" }] } } };
                try { await liff.shareTargetPicker([flexMessage]); } catch (e) { showAlert("Error", "‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ", "error"); }
            }
        }
    }).mount('#app');
</script>
</body>
</html>
